name: release-bib

on:
  workflow_dispatch:

jobs:
  release-bib:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write
    
    steps:
      - uses: actions/checkout@v3

      - name: Download usenix.bib
        run: wget -O usenix.bib https://www.usenix.org/biblio/export/bibtex
        
      - name: Download usenix.bib.old
        run: |
          wget -O usenix.bib.old https://github.com/Pusnow/usenix.bib/releases/latest/download/usenix.bib || true

      - name: Diff files
        run: |
          diff usenix.bib usenix.bib.old || touch changed

      - name: Create release
        run: |
          if [ -f changed ]; then gh release create $(date '+%Y-%m-%d') usenix.bib; fi
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
